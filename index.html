<!doctype html>
<html>
  <body style="font-family: system-ui; max-width: 500px; margin: 24px auto;">
    <h3>Simple QR/Barcode Scanner</h3>
    <video id="v" playsinline style="width:100%;background:#000;border-radius:8px"></video>
    <p id="out">Result: (none)</p>
    <button id="start">Start</button>

    <script type="module">
      import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@latest/esm/index.min.js';

      const video = document.getElementById('v');
      const out = document.getElementById('out');
      let controls = null;

      document.getElementById('start').onclick = async () => {
        // stop old session if any
        if (controls) { try { controls.stop(); } catch {} controls = null; }

        const reader = new BrowserMultiFormatReader();
        controls = await reader.decodeFromVideoDevice(
          null,               // null = default camera
          video,
          (result, err, ctrl) => {
            if (result) {
              out.textContent = 'Result: ' + result.getText();
              ctrl.stop();     // stop after first successful scan
            }
          }
        );
      };
    </script>
  </body>
</html>
